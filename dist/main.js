(()=>{"use strict";class t{constructor(t=0,e=0){this.x=t,this.y=e}add(e=new t){return this.x+=e.x,this.y+=e.y,this}subtract(e=new t){return this.x-=e.x,this.y-=e.y,this}scale(t=1){return this.x*=t,this.y*=t,this}moveTo(t=0,e=0){return this.x=t,this.y=e,this}normalize(){return(this.x||this.y)&&this.scale(1/this.magnitude()),this}distSq(e=new t){const s=this.x-e.x,i=this.y-e.y;return s*s+i*i}dist(e=new t){const s=this.x-e.x,i=this.y-e.y;return Math.hypot(s,i)}dot(e=new t){return this.x*e.x+this.y*e.y}magnitude(){return Math.hypot(this.x,this.y)}static xAxis(e=1){return new t(e,0)}static yAxis(e=1){return new t(0,e)}static direction(e=new t,s=new t){return new t(0,0).add(e).subtract(s).normalize()}static random(e=1){return new t(Math.random()-.5,Math.random()-.5).normalize().scale(e)}static clone(e=new t){return new t(e.x,e.y)}}const e=t,s=class{constructor({pos:t=new e,vel:s=new e,mass:i=0,charge:n=0,radius:h=0}){this.pos=t,this.vel=s,this.mass=i,this.charge=n,this.radius=h,this.protected=!0}momentum(){return e.clone(this.vel).scale(this.mass)}size(){return this.radius}update(){this.pos.add(this.vel)}visualSize(t){return this.radius*t}accelerate(t=new e){this.vel.add(t)}move(t=new e){this.pos.add(t)}grow(t=0){this.mass+=t}delete(){this.protected=!1}isTouching(t=new e,s=0){return this.pos.distSq(t)<(this.size()+s)**2}interact(){return null}},i=class extends s{visualSize(t){return Math.sqrt(this.mass)*t}size(){return Math.sqrt(this.mass)}interact(t){const{pos:i}=t,n=t.size();this.isTouching(i,.1*n)&&this.protected?(((t=new s,e=new s)=>{const i=t.momentum().add(e.momentum()).scale(1/(t.mass+e.mass));t.vel.scale(0),t.accelerate(i)})(this,t),((t=new s,e=new s)=>{t.grow(e.mass),e.delete()})(this,t)):((t=new s,i=new s,n=1/0,h=.025)=>{const o=Math.min(h*t.mass/t.pos.distSq(i.pos),n),c=new e(0,0).add(t.pos).subtract(i.pos);i.accelerate(c.scale(o))})(this,t)}},n=class extends s{interact(t){this.isTouching(t.pos,1*this.size()+t.size())&&((t=new s,i=new s,n=1)=>{i.move(e.direction(i.pos,t.pos).scale(n*(t.size()+i.size())-t.pos.dist(i.pos)))})(this,t,1.1)}},h=class extends s{size(){return.001}interact(t){((t=new s,i=new s,n=1/0,h=2e-11)=>{const o=t.pos.distSq(i.pos),c=Math.min(h/(o*o),n),a=e.direction(i.pos,t.pos);i.accelerate(a.scale(c))})(this,t,25e-5)}},o=class extends s{constructor(t){super(t),this.nearby=[]}interact({pos:t}){this.isTouching(t,0)&&this.nearby.push(t)}},c=(t,s)=>e.random(s*Math.random()).add(t),a={paint:{stars:t=>new i({mass:5e-7,vel:e.random(1e-5),pos:c(t,.03)}),gases:t=>new h({radius:.005,vel:e.random(1e-4),pos:c(t,.1)}),automata:t=>new n({radius:.006,vel:e.random(.001),pos:c(t,.01)}),networks:t=>new o({radius:.1,vel:e.random(2e-4),pos:c(t,.15)}),dots:t=>new s({vel:e.random(1e-5),pos:c(t,.03)})},shoot:{stars:(t,e)=>new i({mass:3e-6,vel:e.scale(.007),pos:c(t,.01)}),gases:(t,e)=>new h({radius:.005,vel:e.scale(.006),pos:c(t,1e-6)}),automata:(t,e)=>new n({radius:.006,vel:e.scale(.003),pos:c(t,.01)}),networks:(t,e)=>new o({radius:.1,vel:e.scale(.003),pos:c(t,.05)}),dots:(t,e)=>new s({vel:e.scale(.003),pos:c(t,.01)})},place:{stars:t=>new i({mass:5e-5,vel:new e(0,0),pos:c(t,.001)}),gases:t=>new h({vel:new e(0,0),pos:c(t,.001),radius:.005}),automata:t=>new n({radius:.006,vel:new e(0,0),pos:c(t,.001)}),networks:t=>new o({radius:.1,vel:new e(0,0),pos:c(t,.001)}),dots:t=>new s({vel:new e(0,0),pos:c(t,.005)})}},r=(t,e)=>{for(let s=0;s<t.length;s+=1){const i=document.createElement("button");i.id=t[s],i.innerText=t[s],document.getElementById(e).appendChild(i)}},l=(t,e)=>()=>document.getElementById(t).classList.add(e),d=(t,e)=>()=>document.getElementById(t).classList.remove(e),u=t=>l(t,"hidden"),p=t=>d(t,"hidden"),w=t=>l(t,"fade-out"),m=t=>()=>new Promise((e=>setTimeout(e,990*t))),x=()=>new Promise((t=>{document.querySelector(".particle-type").addEventListener("click",t)})),y=()=>new Promise((t=>{document.querySelector(".option").addEventListener("click",t)})),g=()=>{window.addEventListener("touchstart",(()=>{l("particle-type","top-peek")(),l("option","bottom-peek")()}),{once:!0})},v=(...t)=>t.reduce(((t,e)=>t.then(e)),Promise.resolve());r(["paint","shoot","place","reset"],"option-buttons"),r(["stars","gases","networks","automata"],"particle-type-buttons");const b=new class{constructor(t=[]){this.particles=t,this.wall=!0,this.needsCleaning=!1}update(){const t=this.particles.length;this.calculateInteractions(t),this.updateParticles(t),this.wall&&this.walls(t),this.needsCleaning&&this.cleanup(t)}addParticle(t=new s){this.particles.push(t)}toggleWalls(){return this.wall=!this.wall,this.wall}cleanup(t=this.particles.length){let e=0;for(let s=0;s<t;s+=1){const t=this.particles[s];t.protected&&(s!==e&&(this.particles[e]=t),e+=1)}this.particles.length=e}updateParticles(t=this.particles.length){for(let e=0;e<t;e+=1)this.particles[e].update()}calculateInteractions(t=this.particles.length){for(let e=0;e<t;e+=1)for(let s=0;s<t;s+=1)e!==s&&this.particles[e].interact(this.particles[s])}walls(t=this.particles.length){for(let s=0;s<t;s+=1){const{pos:t,vel:i}=this.particles[s],n=this.particles[s].size(),h=1-n-t.x,o=1-n-t.y,c=t.x-n,a=t.y-n;h<0?(i.subtract(e.xAxis(2*i.x)),t.add(e.xAxis(h))):c<0?(i.subtract(e.xAxis(2*i.x)),t.subtract(e.xAxis(c))):o<0?(i.subtract(e.yAxis(2*i.y)),t.add(e.yAxis(o))):a<0&&(i.subtract(e.yAxis(2*i.y)),t.subtract(e.yAxis(a)))}}reset(){this.particles.length=0}},A=new class{constructor(t){this.state=t,this.state.needsCleaning=!0,this.mouse=new e(0,0),this.mouseHistory=Array.from({length:4},(()=>new e(0,0))),this.pressing=!1,this.msPerAction=30,this.particleType="stars",this.selectedAction="shoot",this.actions=a,this.addEvents()}get pointer(){return e.direction(this.mouse,this.mouseHistory[0])}handleActions(){return()=>{"place"!==this.selectedAction&&this.continuousAction()}}clickAction(){"place"===this.selectedAction&&this.state.addParticle(this.actions.place[this.particleType](this.mouse))}continuousAction(){this.state.addParticle(this.actions[this.selectedAction][this.particleType](this.mouse,this.pointer))}addEvents(){const t=document.getElementById("option-buttons"),e=document.getElementById("particle-type-buttons"),s=document.querySelector("canvas");t.onclick=this.selectAction(),t.ontouchend=this.selectAction(),e.onclick=this.selectMode(),e.ontouchend=this.selectMode(),s.onmousedown=this.mouseDown(),s.ontouchstart=this.mouseDown(),s.onmouseup=this.mouseUp(),s.ontouchend=this.mouseUp(),document.onmousemove=this.mouseMove(),document.addEventListener("touchmove",this.mouseMove(),{passive:!1})}mouseDown(){return t=>{const e=t.touches?t.touches[0].clientX:t.clientX,s=t.touches?t.touches[0].clientY:t.clientY;this.mouse.moveTo(e/window.innerWidth,s/window.innerHeight),this.pressing=!0,window.clearInterval(this.asyncActions),this.asyncActions=window.setInterval(this.handleActions(),this.msPerAction)}}mouseMove(){return t=>{t.preventDefault(),t.stopPropagation();const s=t.touches?t.touches[0].clientX:t.clientX,i=t.touches?t.touches[0].clientY:t.clientY;this.mouseHistory.shift(),this.mouseHistory.push(e.clone(this.mouse)),this.mouse.moveTo(s/window.innerWidth,i/window.innerHeight)}}mouseUp(){return()=>{this.clickAction(),window.clearInterval(this.asyncActions)}}selectMode(){return t=>{this.particleType!==t.target.id&&(this.state.reset(),this.particleType=t.target.id),this.state.needsCleaning="stars"===this.particleType}}selectAction(){return t=>{switch(t.target.id){case"reset":this.state.reset();break;default:this.selectedAction=t.target.id}}}}(b),f=new class{constructor(t,e){this.particles=t.particles,this.client=e,this.ctx=document.querySelector("canvas").getContext("2d"),this.resize()(),this.reset(),window.onresize=this.resize()}get scale(){return Math.min(this.width,this.height)}render(){this.reset(),this.mouse(this.client.mouse),this.renderParticles()}renderParticles(){this[this.client.particleType]()}stars(){const t=this.particles.length;for(let e=0;e<t;e+=1){const t=this.particles[e];t.visualSize(this.scale)<1?(this.ctx.fillStyle="SandyBrown",this.dot(t)):this.star(t)}}dots(){this.ctx.fillStyle="white";const t=this.particles.length;for(let e=0;e<t;e+=1)this.dot(this.particles[e])}automata(){const t=this.particles.length;for(let e=0;e<t;e+=1)this.automaton(this.particles[e])}gases(){const t=this.particles.length;for(let e=0;e<t;e+=1)this.gas(this.particles[e])}networks(){this.ctx.beginPath(),this.ctx.lineWidth=.3,this.ctx.strokeStyle="rgba(255,255,255,0.5)";const t=this.particles.length;for(let e=0;e<t;e+=1){const t=this.particles[e],s=t.pos.x*this.width,i=t.pos.y*this.height;this.ctx.fillRect(s,i,1,1);const n=t.nearby.length;for(let e=0;e<n;e+=1){const n=t.nearby[e].x*this.width,h=t.nearby[e].y*this.height;this.ctx.moveTo(s,i),this.ctx.lineTo(n,h)}t.nearby.length=0}this.ctx.stroke(),this.ctx.closePath()}resize(){return()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.client.displayWidth=this.width,this.client.displayHeight=this.height,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height}}reset(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="white",this.ctx.strokeStyle="white",this.ctx.shadowBlur=0,this.ctx.shadowColor="rgba(0, 0, 0, 0)",this.ctx.globalCompositeOperation="screen"}mouse({x:t,y:e}){this.ctx.beginPath(),this.ctx.lineWidth=1.5,this.strokeStyle="rgba(255,255,255,0.2)",this.ctx.arc(t*this.width,e*this.height,.008*this.scale,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.closePath()}star(t){const{pos:e}=t,s=t.visualSize(this.scale),i=((t,e=1)=>`rgba(${255*(-104976*(t-.045)**4+1)},${255*(-50625*(t-.07)**4+1)},${255*(-14641*(t-.11)**4+1)},${e})`)(t.size());this.ctx.fillStyle=i,this.ctx.shadowColor=i,this.ctx.shadowBlur=2*s,this.circle(e.x*this.width,e.y*this.height,s)}circle(t,e,s){this.ctx.beginPath(),this.ctx.arc(t,e,s,0,2*Math.PI,!1),this.ctx.fill()}automaton(t){const{pos:e,vel:s}=t,i=t.visualSize(this.scale);this.ctx.fillStyle=(({x:t})=>t>0?"blue":t<0?"green":"grey")(s),this.circle(e.x*this.width,e.y*this.height,i)}gas(t){const{pos:e,vel:s}=t,i=t.visualSize(this.scale);this.ctx.fillStyle=(t=>{const e=t.dot(t);return`hsl(${Math.min(15e3*e*120+240,360)},100%,50%)`})(s),this.circle(e.x*this.width,e.y*this.height,i)}dot({pos:t}){this.ctx.fillRect(t.x*this.width,t.y*this.height,1,1)}line(t,e){this.ctx.beginPath(),this.ctx.moveTo(t.x*this.width,t.y*this.height),this.ctx.lineTo(e.x*this.width,e.y*this.height),this.ctx.stroke(),this.ctx.closePath()}subLine(t,e){this.ctx.moveTo(t.x*this.width,t.y*this.height),this.ctx.lineTo(e.x*this.width,e.y*this.height)}}(b,A);function S(){f.render(),b.update(),requestAnimationFrame(S)}requestAnimationFrame((()=>{(()=>{const t=window.localStorage.getItem("dotsIntros")||"2",e=parseInt(t,10);return window.localStorage.setItem("dotsIntros",Math.max(e-1,0).toString()),e})()?v(p("title"),m(2),u("title"),p("select-particle-type"),l("particle-type","top-peek"),x,d("particle-type","top-peek"),w("select-particle-type"),m(1),u("select-particle-type"),p("select-option"),l("option","bottom-peek"),y,d("option","bottom-peek"),w("select-option"),m(1),u("select-option"),p("enjoy"),m(1),w("enjoy"),m(1),l("enjoy","hidden"),u("welcome"),g):v(p("title"),m(2),u("welcome"),g),S()}))})();
//# sourceMappingURL=main.js.map